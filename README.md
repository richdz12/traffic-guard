# TrafficGuard

–£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–∫–∞–Ω–µ—Ä–æ–≤ –ø–æ—Ä—Ç–æ–≤ —á–µ—Ä–µ–∑ iptables –∏ ipset —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì• –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –ø–æ–¥—Å–µ—Ç–µ–π —Å–∫–∞–Ω–µ—Ä–æ–≤ –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- üõ°Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ iptables/ip6tables –ø—Ä–∞–≤–∏–ª
- üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ipset –Ω–∞–±–æ—Ä–∞–º–∏ –¥–ª—è IPv4 –∏ IPv6
- üìù –õ–µ–≥–∫–æ–≤–µ—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ —à–∞–≥–∏: —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ ipset, iptables, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:

```bash
sudo antiscan full
sudo antiscan full --enable-logging  # –° –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
sudo antiscan full -u https://custom.com/scanners.txt --enable-logging
```

### –û–ø—Ü–∏–∏

- `--log-level` - —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (debug, info, warn, error). –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: info
- `-u, --urls` - —Å–ø–∏—Å–æ–∫ URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ø–æ–¥—Å–µ—Ç–µ–π
- `-l, --enable-logging` - –≤–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (`--enable-logging`) —Å–æ–∑–¥–∞—é—Ç—Å—è:

1. **`/etc/rsyslog.d/10-iptables-scanners.conf`** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è rsyslog
2. **`/etc/logrotate.d/iptables-scanners`** - —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ (–∫–∞–∂–¥—ã–π —á–∞—Å, —Ö—Ä–∞–Ω–∏—Ç—Å—è 2 —á–∞—Å–∞)
3. **`/usr/local/bin/antiscan-aggregate-logs.sh`** - —Å–∫—Ä–∏–ø—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
4. **`/etc/systemd/system/antiscan-aggregate.service`** - systemd service
5. **`/etc/systemd/system/antiscan-aggregate.timer`** - systemd timer (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)

### –§–∞–π–ª—ã –ª–æ–≥–æ–≤

- **`/var/log/iptables-scanners-ipv4.log`** - —Å—ã—Ä—ã–µ –ª–æ–≥–∏ IPv4 (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
- **`/var/log/iptables-scanners-ipv6.log`** - —Å—ã—Ä—ã–µ –ª–æ–≥–∏ IPv6 (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
- **`/var/log/iptables-scanners-aggregate.csv`** - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ CSV —Ñ–æ—Ä–º–∞—Ç–µ

### –§–æ—Ä–º–∞—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ CSV

–§–∞–π–ª `/var/log/iptables-scanners-aggregate.csv` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º whois lookup:

```csv
IP_TYPE|IP_ADDRESS|ASN|NETNAME|COUNT|LAST_SEEN
v4|85.142.100.138|AS49505|JSCCYBEROK-NET|237|2026-01-25T17:08:01.123456+03:00
v6|2001:db8::1|AS12345|EXAMPLE-NET|12|2026-01-25T17:08:05.987654+03:00
```

**–ü–æ–ª—è:**
- `IP_TYPE` - —Ç–∏–ø IP (v4/v6)
- `IP_ADDRESS` - IP –∞–¥—Ä–µ—Å —Å–∫–∞–Ω–µ—Ä–∞
- `ASN` - –Ω–æ–º–µ—Ä –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã (–∏–∑ whois)
- `NETNAME` - –∏–º—è —Å–µ—Ç–∏ (–∏–∑ whois)
- `COUNT` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `LAST_SEEN` - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–ø—ã—Ç–∫–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Whois lookup —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–ª—è –æ–¥–Ω–æ–≥–æ IP)
- –¢–∞–π–º–∞—É—Ç lookup: 3 —Å–µ–∫—É–Ω–¥—ã
- CSV –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ COUNT (—Å–∞–º—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–≤–µ—Ä—Ö—É)

### –õ–∏–º–∏—Ç—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

- –ú–∞–∫—Å–∏–º—É–º **10 –∑–∞–ø–∏—Å–µ–π –≤ –º–∏–Ω—É—Ç—É** –Ω–∞ –∫–∞–∂–¥—ã–π IP (—á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å –ª–æ–≥–∏)
- –¢–æ–ø-50 –∞–∫—Ç–∏–≤–Ω—ã—Ö IP –≤ –∫–∞–∂–¥–æ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
tail -f /var/log/iptables-scanners-aggregate.log

# –°—Ç–∞—Ç—É—Å systemd timer
systemctl status antiscan-aggregate.timer

# –õ–æ–≥–∏ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∞
journalctl -u antiscan-aggregate.service -f
```

## –ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ

### iptables

- **–¶–µ–ø–æ—á–∫–∞**: `SCANNERS-BLOCK`
- **–ü—Ä–∞–≤–∏–ª–∞**: 
  - IPv4: `INPUT -j SCANNERS-BLOCK`
  - IPv6: `INPUT -j SCANNERS-BLOCK`
  - `SCANNERS-BLOCK -m set --match-set SCANNERS-BLOCK-V4 src -j DROP` (IPv4)
  - `SCANNERS-BLOCK -m set --match-set SCANNERS-BLOCK-V6 src -j DROP` (IPv6)

–° –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Å rate-limit.

### ipset

- **–ù–∞–±–æ—Ä—ã**:
  - `SCANNERS-BLOCK-V4` - hash:net –¥–ª—è IPv4
  - `SCANNERS-BLOCK-V6` - hash:net –¥–ª—è IPv6
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: `/etc/ipset.conf`

### –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞

–ü—Ä–∞–≤–∏–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:
- **Debian/Ubuntu**: `/etc/iptables/rules.v4`, `/etc/iptables/rules.v6`
- **RedHat/CentOS**: —á–µ—Ä–µ–∑ `service iptables save`

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT